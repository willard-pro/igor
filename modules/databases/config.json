{
  "module": {
    "name": "databases",
    "label": "Databases",
    "type": "bash",
    "configurable": "true"
  },
  "required": {
    "commands": [
      "mysql",
      "grep",
      "docker"
    ]
  },  
  "pages": [
    {
      "name": "main",
      "label": "Database Administration",
      "command": "${page:database_action}",
      "prompts": [
        {
          "label": "Select database",
          "name": "database_selected",
          "options": "${command:get_databases}"
        },
        {
          "label": "Are you sure you want to select all databases",
          "name": "database_select_all",
          "format": "continue",
          "condition": "${value:prompt.database_selected} == 'all'"
        }
      ]
    },    
    {
      "name": "database_action",
      "label": "Database Action",
      "prompts": [
        {
          "label": "Select action to take",
          "name": "database_action_selected",
          "options": [
            {
              "name": "Start",
              "value": "start",
              "command": "start_database ${value:page.main.prompt.database_selected}"
            },
            {
              "name": "Stop",
              "value": "stop",
              "command": "stop_database ${value:page.main.prompt.database_selected}"
            },
            {
              "name": "Update",
              "value": "update",
              "command": "${page:update}"
            },
            {
              "name": "Backup",
              "value": "backup",
              "command": "backup_database ${value:page.main.prompt.database_selected}"
            },
            {
              "name": "Restore",
              "value": "restore",
              "command": "${page:restore}"
            }
          ]
        }
      ]
    },
    {
      "name": "restore",
      "label": "Restore Database",
      "command": "restore_database ${value:page.main.database_selected} ${value:prompt.backup_latest} ${value:prompt.backup_date}",
      "prompts": [
        {
          "label": "Select the backup source",
          "name": "backup_source",
          "options": "${command:get_backup_sources} ${value:page.main.database_selected}"
        },
        {
          "label": "Do you want to use the latest backup",
          "format": "Yn",
          "name": "backup_latest",
          "validate": {
              "command": "backup_exists ${value:page.main.database_selected} 'latest'",
              "message": "Unable to reach backup source and/or there is no backup marked latest"
            }          
        },
        {
          "label": "Please specify a backup (yyyy-mm-dd)",
          "name": "backup_date",
          "format": "yyyy-mm-dd",
          "condition": "${value:prompt.backup_latest} == 'n'",
          "validate": {
              "command": "backup_exists ${value:page.main.database_selected} ${value:prompt.backup_date}",
              "message": "Unable to reach backup source and/or there is no backup available for ${value:prompt.backup_date}"
            }
        },
        {
          "label": "Are you sure you want to restore database ${value:page.main.database_selected}",
          "format": "continue"
        }
      ]
    },
    {
      "name": "configure",
      "label": "Database Administration Configuration",
      "command": "${configure:done}",
      "prompts": [
        {
          "label": "Provide the file path to the databases configuration",
          "name": "config_file",
          "format": "file",
          "command": "${configure:set}"
        }
      ]
    }
  ]
}
